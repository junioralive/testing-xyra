<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Xyra - Stream</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="description" content="Xyra - A place to discover movies and TV shows. Watch anytime, anywhere.">
    <meta name="keywords" content="Xyra streaming, Xyra Api, Xyra movies, Xyra TV shows, free movie streaming, free TV shows online, watch movies online, stream TV shows, online movie streaming, HD movies free, TV series streaming, Xyra free movies, Xyra stream movies, watch TV shows online, popular movies 2024, trending TV shows, best streaming platform, free movie site, watch free movies, Xyra media streaming, high-quality movie streaming, movie library online, binge-watch movies, latest movie releases, HD streaming movies, free series streaming, full episodes online">
    <meta name="robots" content="index, follow">
    <meta property="og:title" content="Xyra - Discover, Watch, Enjoy Anytime, Anywhere">
    <meta property="og:description" content="Xyra - A place to discover movies and TV shows. Watch anytime, anywhere.">
    <meta property="og:image" content="https://raw.githubusercontent.com/junioralive/Xyra/refs/heads/main/assets/xyra.png">
    <meta property="og:url" content="https://xyrastream.live">
    <meta property="og:type" content="website">
    <link rel="icon" type="image/x-icon" href="https://raw.githubusercontent.com/junioralive/Xyra/refs/heads/main/assets/xyra.png">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        /* Basic reset and styling for the player */
        body, html {
            height: 100%;
            margin: 0;
            background-color: #141414;
            color: #e1e1e1;
            font-family: Arial, sans-serif;
            overflow: hidden;
        }
        .player-container {
            position: relative;
            width: 100%;
            height: 100%;
            background-color: #181818;
            overflow: hidden;
        }
        video {
            width: 100%;
            height: 100%;
            background-color: black;
        }
        .controls {
            position: absolute;
            bottom: 0;
            width: 100%;
            padding: 10px;
            background: rgba(0, 0, 0, 0.7);
            display: flex;
            flex-direction: column;
            align-items: center;
            color: white;
            transition: opacity 0.3s;
            opacity: 0;
        }
        .controls.show {
            opacity: 1;
        }
        .controls-container {
            display: flex;
            justify-content: center;
            align-items: center;
            flex-wrap: wrap;
            width: 100%;
        }
        .control-button {
            background: transparent;
            border: none;
            cursor: pointer;
            color: #e1e1e1;
            font-size: 24px;
            padding: 5px;
            margin: 0 5px;
        }
        .seek-bar-container {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 90%;
            margin: 5px 0;
        }
        .seek-bar-container span {
            flex: 0 0 auto;
            margin: 0 10px;
            text-align: center;
        }
        .seek-bar-wrapper {
            flex: 1;
            position: relative;
            margin: 0 10px;
        }
        .seek-bar {
            width: 100%;
            appearance: none;
            height: 5px;
            background: #444;
            outline: none;
            border-radius: 5px;
            cursor: pointer;
            margin: 0;
        }
        .seek-bar::-webkit-slider-thumb {
            appearance: none;
            width: 10px;
            height: 10px;
            background: #e1e1e1;
            border-radius: 50%;
            cursor: pointer;
        }
        .tooltip {
            position: absolute;
            bottom: 20px;
            background-color: rgba(0, 0, 0, 0.7);
            color: #fff;
            padding: 5px;
            border-radius: 3px;
            font-size: 12px;
            display: none;
            transform: translateX(-50%);
            pointer-events: none;
            white-space: nowrap;
        }
        .volume-control {
            display: flex;
            align-items: center;
        }
        .volume-slider {
            width: 100px;
            margin-left: 5px;
        }
        .dropdown {
            position: relative;
        }
        .dropdown-content {
            display: none;
            position: absolute;
            bottom: 40px;
            left: 50%;
            transform: translateX(-50%);
            background-color: #333;
            min-width: 120px;
            max-height: 200px;
            overflow-y: auto;
            box-shadow: 0px 8px 16px rgba(0, 0, 0, 0.2);
            z-index: 1;
            border-radius: 5px;
        }
        .dropdown-content button {
            width: 100%;
            background-color: transparent;
            border: none;
            color: #e1e1e1;
            padding: 10px;
            cursor: pointer;
            text-align: left;
        }
        .dropdown-content button:hover,
        .dropdown-content button.selected {
            background-color: #444;
        }
        /* Custom scrollbar */
        .dropdown-content::-webkit-scrollbar {
            width: 8px;
        }
        .dropdown-content::-webkit-scrollbar-thumb {
            background: #555;
            border-radius: 4px;
        }
        .dropdown-content::-webkit-scrollbar-thumb:hover {
            background: #777;
        }
        /* Subtitle styling */
        video::cue {
            font-size: 100%;
            color: #fff;
            text-shadow: 2px 2px 4px #000;
            background: transparent;
            transition: line 0.3s ease; /* Smooth transition for caption position */
        }
        /* Position captions above controls when controls are visible */
        .controls.show ~ video::cue {
            position: absolute;
            bottom: 70px; /* Adjust based on controls height */
        }
        /* Hide menus when not active */
        .dropdown-content.show {
            display: block;
        }
        /* Fullscreen adjustments */
        .player-container.fullscreen {
            width: 100vw;
            height: 100vh;
        }
        /* Overlay icon */
        .overlay-icon {
            position: absolute;
            top: 50%;
            left: 50%;
            font-size: 80px;
            color: rgba(255, 255, 255, 0.7);
            transform: translate(-50%, -50%);
            opacity: 0;
            transition: opacity 0.3s;
            pointer-events: none;
            text-align: center;
        }
        .overlay-icon.show {
            opacity: 1;
        }
        
        /* Branding */
        .branding {
            position: absolute;
            top: 30px; /* Increased space from top */
            right: 30px; /* Increased space from right */
            z-index: 2;
            display: flex;
            align-items: center;
        }
        .branding img {
            width: 40px; /* Adjust as needed */
            height: auto;
            cursor: pointer;
        }
        /* Adjustments for control buttons */
        .control-button.icon {
            font-size: 24px;
        }
        /* Responsive adjustments */
        @media screen and (max-width: 600px) {
            .volume-slider {
                width: 30px;
            }
            .control-button {
                font-size: 20px;
            }
            .branding img {
                width: 30px;
            }
        }
    </style>
</head>
<body>

<div class="player-container" id="playerContainer">
    <video id="video" crossorigin="anonymous" playsinline></video>
    <div class="overlay-icon" id="overlayIcon">‚ñ∂</div>
    <!-- Branding -->
    <div class="branding">
        <a href="https://xyrastream.live/" target="_blank">
            <img src="https://raw.githubusercontent.com/junioralive/Xyra/refs/heads/main/assets/xyra.png" alt="XyraStream Logo">
        </a>
    </div>
    <!-- Controls -->
    <div class="controls" id="controls">
        <div class="seek-bar-container">
            <span id="currentTime">00:00:00</span>
            <div class="seek-bar-wrapper">
                <input type="range" id="seek" class="seek-bar" value="0">
                <div id="tooltip" class="tooltip">00:00:00</div>
            </div>
            <span id="duration">00:00:00</span>
        </div>
        <div class="controls-container">
            <button id="playPause" class="control-button icon">‚ñ∂</button>
            <div class="volume-control">
                <button id="volumeIcon" class="control-button icon">üîä</button>
                <input type="range" id="volume" class="volume-slider" min="0" max="1" step="0.1" value="1">
            </div>
            <div class="dropdown">
                <button class="control-button icon" id="qualityButton">üì∫</button>
                <div class="dropdown-content" id="qualityOptions"></div>
            </div>
            <div class="dropdown">
                <button class="control-button icon" id="speedButton">‚è±Ô∏è</button>
                <div class="dropdown-content" id="speedOptions">
                    <button data-speed="0.5">0.5x</button>
                    <button data-speed="1">1x</button>
                    <button data-speed="1.5">1.5x</button>
                    <button data-speed="2">2x</button>
                </div>
            </div>
            <div class="dropdown">
                <button class="control-button icon" id="subtitleButton">üÑ∞</button>
                <div class="dropdown-content" id="subtitleOptions"></div>
            </div>
            <button id="fullscreenButton" class="control-button icon">‚õ∂</button>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
<script>
    const video = document.getElementById('video');
    const playPauseButton = document.getElementById('playPause');
    const seekBar = document.getElementById('seek');
    const currentTimeDisplay = document.getElementById('currentTime');
    const durationDisplay = document.getElementById('duration');
    const volumeSlider = document.getElementById('volume');
    const qualityOptions = document.getElementById('qualityOptions');
    const subtitleOptions = document.getElementById('subtitleOptions');
    const speedOptions = document.getElementById('speedOptions');
    const volumeIcon = document.getElementById('volumeIcon');
    const fullscreenButton = document.getElementById('fullscreenButton');
    const playerContainer = document.getElementById('playerContainer');
    const controls = document.getElementById('controls');
    const overlayIcon = document.getElementById('overlayIcon');
    const qualityButton = document.getElementById('qualityButton');
    const speedButton = document.getElementById('speedButton');
    const subtitleButton = document.getElementById('subtitleButton');
    const tooltip = document.getElementById('tooltip');
    const seekBarWrapper = document.querySelector('.seek-bar-wrapper');
    
    let hls;
    let currentSubtitleUrl = null;
    let currentQualityButton = null;
    let currentSubtitleButton = null;
    let hideControlsTimeout;
    
    // Function to parse URL parameters
    function getQueryParams() {
        const params = {};
        window.location.search.substring(1).split("&").forEach(function(part) {
            const [key, value] = part.split("=");
            params[decodeURIComponent(key)] = decodeURIComponent(value);
        });
        return params;
    }

    async function fetchData() {
        const params = getQueryParams();
        const id = params['id'];
        const route = params['route'] || 'movie';
        const season = params['season'];
        const episode = params['episode'];
        let apiUrl;
        
        // Check if the required parameters are provided
        if (!id || (route === 'show' && (!season || !episode))) {
            alert("Please provide a valid ID, season, and episode.");
            return; // Exit function if required parameters are missing
        }

        if (route === 'movie') {
            apiUrl = `https://vidsrc-api-js-eosin.vercel.app/vidsrc/${id}`;
        } else if (route === 'show' && season && episode) {
            apiUrl = `https://vidsrc-api-js-eosin.vercel.app/vidsrc/${id}?s=${season}&e=${episode}`;
        } else {
            // Default to movie route if no valid route is provided
            apiUrl = `https://vidsrc-api-js-eosin.vercel.app/vidsrc/${id}`;
        }

        const response = await fetch(apiUrl);
        const data = await response.json();
        return data;
    }
    
    async function initializePlayer() {
        const data = await fetchData();
        const { sources, subtitles } = data;
    
        // Load default video quality
        loadVideo(sources[0].url);
    
        // Populate quality options
        sources.forEach((source, index) => {
            const button = document.createElement("button");
            button.textContent = `${source.quality}p`;
            button.onclick = () => {
                loadVideo(source.url);
                highlightSelectedOption(button, 'quality');
            };
            if (index === 0) {
                highlightSelectedOption(button, 'quality');
            }
            qualityOptions.appendChild(button);
        });
    
        // Populate subtitle options
        subtitles.forEach((subtitle, index) => {
            const button = document.createElement("button");
            button.textContent = subtitle.lang;
            button.onclick = () => {
                loadSubtitles(subtitle.url);
                highlightSelectedOption(button, 'subtitle');
            };
            if (index === 0) {
                highlightSelectedOption(button, 'subtitle');
            }
            subtitleOptions.appendChild(button);
        });
    
        // Populate speed options
        const speedButtons = speedOptions.querySelectorAll('button');
        speedButtons.forEach(button => {
            button.addEventListener('click', () => {
                video.playbackRate = parseFloat(button.dataset.speed);
                highlightSelectedOption(button, 'speed');
                closeAllMenus();
            });
            if (button.dataset.speed == "1") {
                highlightSelectedOption(button, 'speed');
            }
        });
    }

    function highlightSelectedOption(button, type) {
        if (type === 'quality') {
            if (currentQualityButton) {
                currentQualityButton.classList.remove('selected');
            }
            currentQualityButton = button;
        } else if (type === 'subtitle') {
            if (currentSubtitleButton) {
                currentSubtitleButton.classList.remove('selected');
            }
            currentSubtitleButton = button;
        } else if (type === 'speed') {
            const speedButtons = speedOptions.querySelectorAll('button');
            speedButtons.forEach(btn => btn.classList.remove('selected'));
        }
        button.classList.add('selected');
        closeAllMenus();
    }

    function loadVideo(source) {
        if (hls) hls.destroy();
        if (Hls.isSupported()) {
            hls = new Hls();
            hls.loadSource(source);
            hls.attachMedia(video);
            hls.on(Hls.Events.MANIFEST_PARSED, () => {
                video.play();
            });
            hls.on(Hls.Events.ERROR, function(event, data) {
                if (data.fatal) {
                    switch (data.type) {
                        case Hls.ErrorTypes.NETWORK_ERROR:
                            console.error("Network error encountered");
                            hls.startLoad();
                            break;
                        case Hls.ErrorTypes.MEDIA_ERROR:
                            console.error("Media error encountered");
                            hls.recoverMediaError();
                            break;
                        default:
                            console.error("An unrecoverable error occurred");
                            hls.destroy();
                            break;
                    }
                }
            });
        } else if (video.canPlayType('application/vnd.apple.mpegurl')) {
            video.src = source;
            video.addEventListener('loadedmetadata', () => {
                video.play();
            });
        } else {
            console.error("HLS is not supported in this browser");
        }

        video.addEventListener('loadedmetadata', () => {
            durationDisplay.textContent = formatTime(video.duration);
            seekBar.max = video.duration;
        });

        // Reload subtitles if any
        if (currentSubtitleUrl) {
            loadSubtitles(currentSubtitleUrl);
        }
    }

    function loadSubtitles(subtitleUrl) {
        // Remove previous tracks
        const tracks = video.querySelectorAll('track');
        tracks.forEach(trackElement => {
            trackElement.track.mode = 'disabled';
            trackElement.parentNode.removeChild(trackElement);
        });

        if (subtitleUrl) {
            const trackElement = document.createElement("track");
            trackElement.kind = "subtitles";
            trackElement.label = "Subtitles";
            trackElement.src = subtitleUrl;
            trackElement.default = true;
            video.appendChild(trackElement);

            trackElement.addEventListener('load', () => {
                trackElement.track.mode = 'showing';
            });

            // For browsers that don't fire 'load' event
            if (trackElement.track && trackElement.track.readyState === 2) {
                trackElement.track.mode = 'showing';
            }

            currentSubtitleUrl = subtitleUrl;
        } else {
            currentSubtitleUrl = null;
        }
    }

    function togglePlayPause() {
        if (video.paused) {
            video.play();
            playPauseButton.innerHTML = "‚ùö‚ùö";
            showOverlayIcon('‚ùö‚ùö');
        } else {
            video.pause();
            playPauseButton.innerHTML = "‚ñ∂";
            showOverlayIcon('‚ñ∂');
        }
    }

    function showOverlayIcon(icon) {
        overlayIcon.innerHTML = icon;
        overlayIcon.classList.add('show');
        setTimeout(() => {
            overlayIcon.classList.remove('show');
        }, 500);
    }

    function updateSeekBar() {
        seekBar.value = video.currentTime;
        currentTimeDisplay.textContent = formatTime(video.currentTime);
    }

    function formatTime(seconds) {
        seconds = Math.floor(seconds);
        const hrs = Math.floor(seconds / 3600).toString().padStart(2, '0');
        const mins = Math.floor((seconds % 3600) / 60).toString().padStart(2, '0');
        const secs = Math.floor(seconds % 60).toString().padStart(2, '0');
        return `${hrs}:${mins}:${secs}`;
    }

    // Fullscreen functionality - activate only on button click, not on touch or screen taps
    fullscreenButton.addEventListener('click', toggleFullscreen);

    function toggleFullscreen() {
        // Check if fullscreen is already enabled
        if (!document.fullscreenElement) {
            // Try fullscreen on video element
            if (video.requestFullscreen) {
                video.requestFullscreen().catch(err => {
                    alert(`Error attempting to enable full-screen mode: ${err.message}`);
                });
            } else if (video.webkitRequestFullscreen) { // Safari
                video.webkitRequestFullscreen();
            } else if (video.msRequestFullscreen) { // IE11
                video.msRequestFullscreen();
            } else if (video.mozRequestFullScreen) { // Firefox
                video.mozRequestFullScreen();
            }
            fullscreenButton.textContent = "‚ùê"; // Update button icon to exit fullscreen
        } else {
            // Exit fullscreen
            if (document.exitFullscreen) {
                document.exitFullscreen();
            } else if (document.webkitExitFullscreen) { // Safari
                document.webkitExitFullscreen();
            } else if (document.msExitFullscreen) { // IE11
                document.msExitFullscreen();
            } else if (document.mozCancelFullScreen) { // Firefox
                document.mozCancelFullScreen();
            }
            fullscreenButton.textContent = "‚õ∂"; // Update button icon to fullscreen
        }
    }
    

    // Update captions when controls toggle visibility
    function showControls() {
        controls.classList.add('show');
        updateCaptionsPosition(); // Update caption position when controls are shown
        clearTimeout(hideControlsTimeout);

        hideControlsTimeout = setTimeout(() => {
            controls.classList.remove('show');
            updateCaptionsPosition(); // Reset caption position when controls are hidden
        }, 3000);
    }

    // Initial setup
    video.addEventListener('loadedmetadata', updateCaptionsPosition);
    playerContainer.addEventListener('mousemove', showControls);
    playerContainer.addEventListener('click', showControls);
    video.addEventListener('play', showControls);
    video.addEventListener('pause', showControls);
    window.addEventListener('resize', updateCaptionsPosition);

    // Update captions position based on controls visibility
    function updateCaptionsPosition() {
        const tracks = video.textTracks;
        const isMobile = window.innerWidth <= 600;
        const baseLine = isMobile ? -1 : -2; // Base position of captions
        const controlsVisibleOffset = controls.classList.contains('show') ? -3 : baseLine; // Adjust position based on controls

        for (let i = 0; i < tracks.length; i++) {
            const cues = tracks[i].cues;
            if (cues) {
                for (let j = 0; j < cues.length; j++) {
                    cues[j].line = controlsVisibleOffset; // Dynamically set the caption line
                }
            }
        }
    }
    

    controls.addEventListener('transitionend', updateCaptionsPosition);

    // Seek functionality with seek bar
    seekBar.addEventListener('input', () => {
        video.currentTime = seekBar.value;
    });

    // Seek bar tooltip functionality
    seekBar.addEventListener('mousemove', (e) => {
        const rect = seekBar.getBoundingClientRect();
        const percent = (e.clientX - rect.left) / rect.width;
        const time = percent * video.duration;
        tooltip.textContent = formatTime(time);
        tooltip.style.left = `${e.clientX - rect.left}px`;
        tooltip.style.display = 'block';
    });

    seekBar.addEventListener('mouseout', () => {
        tooltip.style.display = 'none';
    });

    // Tap gestures for seeking
    let lastTapTime = 0;
    let tapTimeout;

    video.addEventListener('click', (event) => {
        const currentTime = new Date().getTime();
        const tapGap = currentTime - lastTapTime;
        const x = event.offsetX;
        const width = video.clientWidth;

        if (tapGap < 300 && tapGap > 0) {
            // Double tap detected
            if (x < width / 2) {
                // Left side
                video.currentTime -= 10; // Seek backward 10 seconds
                showOverlayIcon('-10s');
            } else {
                // Right side
                video.currentTime += 10; // Seek forward 10 seconds
                showOverlayIcon('+10s');
            }
            lastTapTime = 0;
        } else {
            // Single tap
            lastTapTime = currentTime;
            clearTimeout(tapTimeout);
            tapTimeout = setTimeout(() => {
                // Single tap action (toggle play/pause)
                togglePlayPause();
                lastTapTime = 0;
            }, 300);
        }
    });

    video.addEventListener('touchend', (event) => {
        const currentTime = new Date().getTime();
        const touchGap = currentTime - lastTapTime;
        const touch = event.changedTouches[0];
        const x = touch.clientX - video.getBoundingClientRect().left;
        const width = video.clientWidth;

        if (touchGap < 300 && touchGap > 0) {
            // Double tap detected
            if (x < width / 2) {
                // Left side
                video.currentTime -= 10; // Seek backward 10 seconds
                showOverlayIcon('-10s');
            } else {
                // Right side
                video.currentTime += 10; // Seek forward 10 seconds
                showOverlayIcon('+10s');
            }
            lastTapTime = 0;
            event.preventDefault();
        } else {
            // Single tap
            lastTapTime = currentTime;
            clearTimeout(tapTimeout);
            tapTimeout = setTimeout(() => {
                // Single tap action (toggle play/pause)
                togglePlayPause();
                lastTapTime = 0;
            }, 300);
        }
    });

    // Volume control
    volumeSlider.addEventListener('input', (event) => {
        video.volume = event.target.value;
        updateVolumeIcon();
    });

    function updateVolumeIcon() {
        if (video.volume > 0.5) {
            volumeIcon.textContent = "üîä";
        } else if (video.volume > 0) {
            volumeIcon.textContent = "üîâ";
        } else {
            volumeIcon.textContent = "üîá";
        }
    }

    volumeIcon.addEventListener('click', () => {
        if (video.volume > 0) {
            video.volume = 0;
        } else {
            video.volume = volumeSlider.value || 1;
        }
        updateVolumeIcon();
    });

    // Play/Pause functionality
    playPauseButton.addEventListener('click', togglePlayPause);

    // Update time and seek bar
    video.addEventListener('timeupdate', updateSeekBar);

    // Dropdown menus toggle
    function toggleDropdown(event) {
        event.stopPropagation();
        const dropdownContent = event.currentTarget.nextElementSibling;
        dropdownContent.classList.toggle('show');
        // Close other menus
        document.querySelectorAll('.dropdown-content').forEach(content => {
            if (content !== dropdownContent) {
                content.classList.remove('show');
            }
        });
    }

    qualityButton.addEventListener('click', toggleDropdown);
    speedButton.addEventListener('click', toggleDropdown);
    subtitleButton.addEventListener('click', toggleDropdown);

    // Close menus when clicking outside
    document.addEventListener('click', (event) => {
        if (!event.target.closest('.control-button') && !event.target.closest('.dropdown-content')) {
            closeAllMenus();
        }
    });

    function closeAllMenus() {
        document.querySelectorAll('.dropdown-content').forEach(content => {
            content.classList.remove('show');
        });
    }

    initializePlayer();
</script>
</body>
</html>
